{{#partial "content"}}

    {{> (dynamic "mediaUpload")}}

  <div class="quickpost">

    <div class="qpHeader">
      {{> (dynamic "logo") }}
      <div class="pageTitle">{{i18n this.formContent.pagetitle}}</div>
      <div class="clear"></div>
    </div>

    <form action="" method="post" id="postForm">
        <div class="imgUploadContainer">
            <ul id="thumb-nails"></ul>
            <div class="uploadWrapper">
              <div class="upload-icon one">
                <input type="file" name="pic" accept="image/*" id="fileUpload">
                <span class="upload-icon-content">+</span><span class="inner"></span>
              </div>
              <div class="clear"></div>
            </div>
            <div class="clear"></div>
        </div>

        <div class="qpWrapper">

            {{!-- Description --}}
            <div class="field-wrapper">
              <div class="description">
                <textarea id="description" name="description" {{#if this.flash.errors}}class="error"{{/if}} placeholder="{{i18n this.formContent.descriptionPlaceholder}}">{{i18n this.formContent.descriptionValue}}</textarea>
                {{#with this.flash.fieldErrors.description}}
                  <p class="error noHeaderError"><span class="icon-alert-blue"></span>{{this}}</p>
                {{/with}}
              </div>
            </div>

            {{!-- Category Selector --}}
            <!--
            <div class="field-wrapper">
              <div class="select-category">
                <select name="category" class="custom-input" {{#if this.flash.errors}}class="error"{{/if}}>
                    <option value="-1" selected>{{i18n this.formContent.categoryText}}</option>
                    {{#each this.category.children}}
                        <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>{{i18n this.localizedName}}</option>
                    {{/each}}
                </select>
              </div>
              {{#with this.flash.fieldErrors.category}}
                <p class="error noHeaderError"><span class="icon-alert-blue"></span>{{this}}</p>
              {{/with}}
            </div>
            -->

            {{!-- BEGIN NEW CATEGORY SELECTOR --}}
            <!-- L1 Category Selector -->
            <style>
            div.select-category > label{
              font-size: 1.3em;
              padding-left: 0.4em;
            }

            div.select-category {
              padding-bottom: 1em;
            }

            div.mobile-only {
              width: 80%;
              margin: 0 auto;
              margin-top: 1em;
            }

            div.mobile-only .mm-listview > li > span.base-panel {
              text-overflow: ellipsis;
              white-space: nowrap;
              overflow: hidden;
              width: 80%;
              background-color: transparent;
            }

            div.nav-cont.selMenu.mm-last {
              z-index: 2000;
              border: 2px solid green;
            }
            </style>

            <div class="field-wrapper">
                <div class="select-category">
                  <div id="catSelector" class="menu-cnt">
                    <div id="mobileCats" class="mobile-only">
                      <div class="body">
                          <nav id="cat-list">
                              <div>
                                  <div class="base-panel-container">
                                      <ul>
                                         <li><span class="mm-arrow base-panel" href="#"><span class="initial-label">{{i18n "postad.select.category.$$"}}</span></span></li>
                                     </ul>
                                  </div>
                              </div>

                              <!-- subpanel -->
                              <div class="item-list Panel">
                                  {{#block "PrecompiledCatCascadeMenu"}}{{/block}}
                              </div>
                          </nav>
                      </div>
                    </div>
                  </div>
                  <input type="hidden" name="category" value="" />
                </div>
                {{#with this.flash.fieldErrors.category}}
                    <p class="error noHeaderError"><span class="icon-alert-blue"></span>{{this}}</p>
                {{/with}}
            </div>
            {{!-- END NEW CATEGORY SELECTOR --}}

            {{!-- Price --}}
            <div class="field-wrapper">
              <div class="price">
                  <input class="custom-input" type="text" name="price" placeholder="{{i18n this.formContent.pricePlaceholder}}" value="{{i18n this.formContent.priceValue}}"/>
              </div>
            </div>

            {{!-- Share on FB --}}
            <div class="field-wrapper">
              <div class="socialMedia">
                  <span class="smedia">{{i18n this.formContent.sharefbText}}</span>
                  {{> (dynamic "switchButton") }}
              </div>
            </div>

            <div class="field-wrapper">
              <div class="select-location">
                {{> (dynamic "mapLatLong") }}
                <input id="location" class="custom-input" type="text" name="location" placeholder="{{i18n this.formContent.locationText}}" value="{{this.formContent.location}}"/>
                <input type="hidden" id="latitude" name="latitude" value = "{{this.formContent.latitude}}"/>
                <input type="hidden" id="longitude" name="longitude" value = "{{this.formContent.longitude}}"/>
                <input type="hidden" id="address" name="address" value = "{{this.formContent.address}}"/>
                <div class="infos">
                  <span>We won't show it on the ad.</span>
                  <span>But, if you want to show your precise location then</span>
                  <span id="maps-link"> select your location instead through a map.</span>
                </div>
              </div>

              {{!-- Map holder --}}
              <div id="map_canvas_wrapper">
                  <div id="map_canvas"></div>
              </div>
            </div>
        </div>

        <div class="inforules">
            <span>{{i18n this.formContent.beforeSellText}}</span>
        </div>
        <div class="qpost">
            <input class="quickSubmit" type="submit" value="{{i18n this.formContent.sellitText}}" />
        </div>

    </form>

  </div>
{{/partial}}

{{#partial "headerWrapper"}}{{/partial}}
{{#partial "footerWrapper"}}{{/partial}}


{{#partial "pageTailScripts"}}
<script type="text/javascript" src='/views/components/mapLatLong/js/mapLatLong.js'></script>
<script type="text/javascript" src='/views/components/mobileSelectorMenu/js/jquery.menu.min.js'></script>
<script type="text/javascript" src='/views/components/mobileSelectorMenu/js/MobileItemSelector.js'></script>

<script>
   $(document).ready(function () {
      var GMapObj = BOLT.MapLatLong;

      function openMap() {

        if (!openMap.opened) {
          $("#map_canvas_wrapper").slideDown("slow");
        } else {
          $("#map_canvas_wrapper").slideUp("slow", function () {
           var latlongData = GMapObj.getLatLong();

           /////////
           // @Nacer, please refactor this code
           $("#latitude").val(latlongData.lat);
           $("#longitude").val(latlongData.long);
           $("#address").val(latlongData.address);

           $("#location").val(latlongData.address);
           /////////
          });
        }
        openMap.opened = !openMap.opened;
      }
      openMap.opened = false;

      $("#maps-link").click(openMap);

      $(document).on("applyLocation", function(e, latlongData) {
        ///////
        // @Nacer, please refactor this code
           $("#latitude").val(latlongData.lat);
           $("#longitude").val(latlongData.long);
           $("#address").val(latlongData.address);

           $("#location").val(latlongData.address);
        //////
      });

      ///////////////////
      // Category Selector - Please refactor
      ///////////////////
      function mobileCategorySelector () {
        var Bolt = Bolt || {};
        var PAC = BOLT.POSTAD.MobileItemSelector || undefined;
        var mobileCatConfig;
        var catMobileSelObj;
        var pageMode;

        Bolt._postFormMsgs = {
            selectLocationLabel : '{{i18n "postad.select.location"}}',
            selectCategoryLabel : '{{i18n "postad.select.category.$$"}}',
            categorySearchPlaceholder : '{{i18n "postad.select.category.sampleSearch"}}'
        }

        mobileCatConfig = {
            title:  Bolt._postFormMsgs.selectCategoryLabel || "",
            searchPlaceholder:  Bolt._postFormMsgs.categorySearchPlaceholder || "",
           // noResultsLabel: "No Results!",
            highlightItemOnNewPanel : false,
            selectors: {
                menuContainer: "#cat-list",
                mobileContainer: "#mobileCats",
                basePanel: ".base-panel",
                itemListPanel: ".item-list"
            }
        };

        if (typeof PAC !== "undefined" && $("#mobileCats").length > 0) {
            if (!catMobileSelObj) {
                catMobileSelObj = new PAC();
            }
        }

        if (catMobileSelObj.hasRendered()) {
            $("#catSelector").show();
            $("#mobileCats").show();
            $("#cat-list").trigger("MobileListNodesReady");
            return;
        }

        pageMode = {
            idEdit :  false,
            isPreview :  false,
            isSimilarAd : false
        };

        if (catMobileSelObj) {
          catMobileSelObj.init(mobileCatConfig, pageMode);
        }

        // Listener to update the category Id when the user selects a category.
        $(document).on("MobileLeafReached", function (e, obj) {
            if (catMobileSelObj === obj.currentInstance) {
              console.log(obj.id + " ===> " + obj.label);
              window.setTimeout(function () {
                 $("#mobileCats .base-panel-container > ul > li").removeClass("mm-hidden");

                 // Set the Category name
                 $("#mobileCats .base-panel .initial-label").text(obj.label);
              }, 100);

              // Set the Category Id in a hidden var.
              $("input[name=category]").val(obj.id);
            }
        });
      }

      mobileCategorySelector();

   });
</script>
{{/partial}}

{{#partial "PrecompiledCatCascadeMenu"}}
<ul class="nav-cont selMenu ">
  {{#each this.categoryData.nodes}}
  <li class="nav-item" data-id="{{this.id}}" data-leaf="true">
      <span class="item-text">{{this.localizedName}}</span>
  </li>
  {{/each}}
</ul>
{{/partial}}
